<!doctype html>
<html lang="en" xmlns="http://www.w3.org/1999/html">
    <head>
        <meta charset="utf-8">
        <title>Migrando do PHP 5.6 para o PHP 7.0</title>
        <meta name="description" content="Migrando do PHP 5.6 para o PHP 7.0">
        <meta name="author" content="Diego Nobre">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
        <link rel="stylesheet" href="css/theme.css" id="theme">
        <link rel="stylesheet" href="bower_components/reveal.js/lib/css/zenburn.css">
        <!-- Printing and PDF exports -->
        <script>
            var link = document.createElement('link');
            link.rel = 'stylesheet';
            link.type = 'text/css';
            link.href = window.location.search.match(/print-pdf/gi) ? 'bower_components/reveal.js/css/print/pdf.css'
                : 'bower_components/reveal.js/css/print/paper.css';
            document.getElementsByTagName('head')[0].appendChild(link);
        </script>

        <!-- Needed for charts to work. Fall back to network if no local copy -->
        <script type='text/javascript' src='js/rasmus-performance-graph/jquery.min.js'></script>
        <script>window.jQuery || document.write('<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js">\x3C/script>')</script>
        <script src="js/rasmus-performance-graph/highcharts.js"></script>
        <script>window.Highcharts || document.write('<script src="http://code.highcharts.com/highcharts.js">\x3C/script>')</script>
    </head>
    <body>
        <div class="reveal">
            <div class="slides">
                <section id="ola">
                    <h1>Olá!</h1>
                </section>

                <section>
                    <h1>Eu sou<span class="doctrine-color">Diego</span>!</h1>
                </section>

				<section id="vox"><img src="assets/img/vox-logo.png"/></section>

				<section>
					<img src="assets/img/ZCE-PHP5-3-logo-XS.jpg"/>
				</section>

				<section id="marco-pivetta-ocramius">
                    <blockquote about="github.com/Ocramius/zf2-best-practices">
                        O layout desses slides foi clonado do <span class="zf-color">Ocramius</span>
                        também conhecido como <strong>Marco Pivetta</strong>
                        <br />(o cara do Doctrine/ZendFramework)
                        <br/><br/>
                        Você pode acessar o original aqui
                        <a href="github.com/Ocramius/zf2-best-practices" target="_blank">github.com/Ocramius/zf2-best-practices</a>
                    </blockquote>
                    <p class="fragment">Ele esteve aqui em João Pessoa em <span class="zf-color">outubro/2015</span> participando do <a href="http://phpeste.net/" target="_blank">PHPESTE</a></p>
                </section>

                <section id="migrando-do-php-56-para-o-php-7">
                    <h2>
                        <span class="doctrine-color">Migrando do PHP 5.6</span><br/>
                        <span class="zf-color">para o <strong>PHP 7.0</strong></span>
                    </h2>
                </section>
                <section>
                    <h2>Sobre o que é essa apresentação?</h2>
                </section>
                <section>
                    <h2><strong>Não é</strong> sobre<br/>
                        <span class="php-color">Mágica</span>
                    </h2>
                    <p class="fragment">Não falarei sobre scripts de migração automática</p>
                </section>
                <section>
                    <h2>
                        Mais <span class="zf-color"><strong>overview</strong></span> do que
                        <br/>
                        <span class="doctrine-color">aprofundamento</span> no código
                    </h2>
                </section>
                <section>
                    <h2>Calma que já vamos <span class="zf-color">começar</span>!</h2>
                </section>
                <section id="o-que-diz-a-documentacao">
                    <h2>
                        O que diz a <span class="doctrine-color">documentação</span>?
                    </h2>
                    <!--
					<ul class="fragment">
                        <li><code>ConfigProviderInterface</code></li>
                        <li><code>InitProviderInterface</code> (optional)</li>
                        <li><code>BootstrapListenerInterface</code> (optional)</li>
                    </ul>
					
					<ol>
                        <li class="fragment">Convert request data to validated data</li>
                        <li class="fragment">Call domain layer</li>
                        <li class="fragment">Serialize response (view model)</li>
                    </ol>
					
					<p class="fragment">Incompatibilidade com versões anteriores</p>
                    <p class="fragment">Novos recursos e recursos depreciados na versão 7.0.x</p>
                    <p class="fragment">Funções alteradas e novas funções</p>
                    <p class="fragment">Novas classes, interfaces e constantes globais</p>
                    <p class="fragment">Mudanças nos módulos SAPI e extensões removidas</p>
                    <p class="fragment">Outras alterações</p> -->
                </section>

                <section>
                    <h2>O <strong>PHP 7</strong> está em <span class="doctrine-color">desenvolvimento</span>!</h2>
                    <p class="fragment">(algumas coisas ainda podem mudar)</p>
                </section>

                <section id="voce-sabe-por-onde-comecar">
                    <h2>
                        Você <strong>SABE</strong>
                        <br/>
                        por onde <span class="zf-color">começar</span>?
                    </h2>
                    <p class="fragment">Existe <strong>incompatibilidade</strong> com <span class="doctrine-color">versões anteriores</span>?</p>
                    <p class="fragment">Alguma <strong>função nova</strong> ou <span class="doctrine-color">alterada</span>?</p>
                    <p class="fragment">Em relação a <strong>classes, interfaces e constantes</strong> há algo de <span class="doctrine-color">novo</span>?</p>
                </section>

                <section id="performance">
                    <h2>Que tal começar com a <span class="zf-color">performance</span>?</h2>
                    <p class="fragment">Os slides a seguir foram criados por Rasmus Lerdorf (criador do PHP)</p>
                    <p class="fragment">Estão disponíveis no link <a href="http://talks.php.net/oz15#/boxspecs" target="_blank">talks.php.net/oz15</a></p>
                </section>

                <!-- https://www.zend.com/en/resources/php7_infographic -->

                <!-- SLIDES DE HASMUS http://talks.php.net/oz15#/ -->
                <section id="boxspecs">
                    <h2 margin-bottom="2em">Test Box Specs</h2>
                    <ul>
                        <li class="fragment" style="font-size: 0.8em;">Gigabyte Z87X-UD3H i7-4771 4 cores @ 3.50GHz w/ 16G of Ram @ 1600MHz</li>
                        <li class="fragment" style="font-size: 0.8em;">Hyperthreading enabled for a total of 8 virtual cores</li>
                        <li class="fragment" style="font-size: 0.8em;">Toshiba THNSNHH256GBST SSD</li>
                        <li class="fragment" style="font-size: 0.8em;">Linux debian 3.2.0-4-amd64 #1 SMP Debian 3.2.65-1+deb7u1 x86_64 GNU/Linux</li>
                        <li class="fragment" style="font-size: 0.8em;">MySQL 5.6.22</li>
                        <li class="fragment" style="font-size: 0.8em;">nginx-1.2.1 + php-fpm for all tests unless indicated otherwise</li>
                        <li class="fragment" style="font-size: 0.8em;">Quiet local 100Mbps network</li>
                        <li class="fragment" style="font-size: 0.8em;">siege benchmark tool run from a separate machine</li>
                    </ul>
                    <p>Dados disponíveis em <a href="http://talks.php.net/oz15#/boxspecs" target="_blank">talks.php.net/oz15</a></p>
                </section>

                <section id="drupalbench">
                    <div id="drupalbench_container" class="stretch" style="margin: 0 auto"></div>
                    <script src="js/rasmus-performance-graph/drupalbench.js"></script>
                    <p>Dados disponíveis em <a href="http://talks.php.net/oz15#/boxspecs" target="_blank">talks.php.net/oz15</a></p>
                </section>

                <section id="wpbench">
                    <div id="wpbench_container" class="stretch" style="margin: 0 auto"></div>
                    <script src="js/rasmus-performance-graph/wpbench.js"></script>
                    <p>Dados disponíveis em <a href="http://talks.php.net/oz15#/boxspecs" target="_blank">talks.php.net/oz15</a></p>
                </section>

                <section id="bbbench">
                    <div id="bbbench_container" class="stretch" style="margin: 0 auto"></div>
                    <script src="js/rasmus-performance-graph/bbbench.js"></script>
                    <p>Dados disponíveis em <a href="http://talks.php.net/oz15#/boxspecs" target="_blank">talks.php.net/oz15</a></p>
                </section>

                <section id="mwbench">
                    <div id="mwbench_container" class="stretch" style="margin: 0 auto"></div>
                    <script src="js/rasmus-performance-graph/mwbench.js"></script>
                    <p>Dados disponíveis em <a href="http://talks.php.net/oz15#/boxspecs" target="_blank">talks.php.net/oz15</a></p>
                </section>

                <section id="opencartbench">
                    <div id="opencartbench_container" class="stretch" style="margin: 0 auto"></div>
                    <script src="js/rasmus-performance-graph/opencartbench.js"></script>
                    <p>Dados disponíveis em <a href="http://talks.php.net/oz15#/boxspecs" target="_blank">talks.php.net/oz15</a></p>
                </section>

                <section id="moodlebench">
                    <div id="moodlebench_container" class="stretch" style="margin: 0 auto"></div>
                    <script src="js/rasmus-performance-graph/moodlebench.js"></script>
                    <p>Dados disponíveis em <a href="http://talks.php.net/oz15#/boxspecs" target="_blank">talks.php.net/oz15</a></p>
                </section>
				
				<section id="compatibilidade">
                    <h2><span class="zf-color"><strong>Compatibilidade</strong></span> com versões anteriores</h2>
                </section>

                <section>
                    <h2>Mudanças na <span class="zf-color">captura</span> de <span class="doctrine-color">erros</span> e exceções</h2>
                    <p class="fragment">Muitos <strong>erros fatais</strong> foram convertidos em <span class="zf-color">exceções</span></p>
                    <p class="fragment">Essas <span class="doctrine-color">exceções</span> herdam da classe <strong>Error</strong></p>
                    <p class="fragment">A classe <strong>Error</strong> implementa a interface <strong>Throwable</strong></p>
                </section>
				
				<section id="mudancas-no-e_strict">
                    <h2>Mudanças severas no <span class="doctrine-color"><strong>E_STRICT</strong></span></h2>
                    <table class="reveal">
                        <tr class="fragment">
                            <td>Faltando assinatura ao usar herança</td>
                            <td><strong>E_WARNING</strong></td>
                        </tr>
                        <tr class="fragment">
                            <td>Acessando propriedade estática "não-estaticamente"</td>
                            <td><strong>E_NOTICE</strong></td>
                        </tr>
                        <tr class="fragment">
                            <td>Chamando métodos não estáticos estaticamente | <code>$foo::bar();</code></td>
                            <td><strong>E_DEPRECATED</strong></td>
                        </tr>
                    </table>
                </section>

                <section id="variaveis-propriedades-metodos">
                    <h3>Variáveis, propriedades e métodos</h3>
                    <table class="reveal">
                        <tr>
                            <th>Expression</th>
                            <th>PHP 5 interpretation</th>
                            <th>PHP 7 interpretation</th>
                        </tr>
                        <tr class="fragment">
                            <td>
                                $foo-&gt;$bar['baz']
                            </td>
                            <td>
                                <code class="code">$foo-&gt;{$bar['baz']}</code>
                            </td>
                            <td>
                                ($foo-&gt;$bar)['baz']
                            </td>
                        </tr>
                        <tr class="fragment">
                            <td>
                                $foo-&gt;$bar['baz']()
                            </td>
                            <td>
                                <code class="code">$foo-&gt;{$bar['baz']}()</code>
                            </td>
                            <td>
                                ($foo-&gt;$bar)['baz']()
                            </td>
                        </tr>
                        <tr class="fragment">
                            <td>
                                Foo::$bar['baz']()
                            </td>
                            <td>
                                <code class="code">Foo::{$bar['baz']}()</code>
                            </td>
                            <td>
                                (Foo::$bar)['baz']()
                            </td>
                        </tr>
                    </table>
                </section>

                <section id="manipulacao-do-list">
                    <h2>Mudanças na manipulação do <span class="php-color">list()</span></h2>
                    <p class="fragment">Não atribui mais os valores na <span class="doctrine-color">ordem inversa</span></p>
                    <pre class="fragment"><code class="php" data-trim>
list($a[], $a[], $a[]) = [1, 2, 3];
var_dump($a);
                    </code></pre>
                </section>

                <section>
                    <h2>O código anterior no </h2>
                    <h2><span class="doctrine-color">PHP 5</span></h2>
                   <pre class="fragment"><code class="php" data-trim>
array(3) {
  [0]=>
  int(3)
  [1]=>
  int(2)
  [2]=>
  int(1)
}
                    </code></pre>
                </section>

                <section>
                    <h2>O mesmo código no</h2>
                    <h2><span class="zf-color">PHP 7</span></h2>
                   <pre class="fragment"><code class="php" data-trim>
array(3) {
  [0]=>
  int(1)
  [1]=>
  int(2)
  [2]=>
  int(3)
}
                    </code></pre>
                </section>

                <section id="sobre-o-list">
                    <h2>Sobre o <span class="php-color">list()</span></h2>
                    <p class="fragment">Não deixe seu código <strong>apegado</strong> à ordenação</p>
                    <p class="fragment">Foi removida a opção de list() vazio</p>
                    <p class="fragment">Não desempacota mais - use o <span class="php-color">str_split()</span> para isso</p>
                </section>

                <section id="ordenacao-de-arrays">
                    <h2>Ordenação de <span class="php-color">Arrays</span></h2>
                    <h3>quando os elementos são criados durante <span class="doctrine-color">passagem por referência</span></h3>
                </section>

                <section>
                    <h3><span class="zf-color">Mudança</span> na ordenação dos elementos</h3>
                     <pre class="fragment"><code class="php" data-trim>
$array = [];
$array["a"] =& $array["b"];
$array["b"] = 1;
var_dump($array);
                     </code></pre>
                </section>

                <section>
                    <h2>O código anterior no </h2>
                    <h2><span class="doctrine-color">PHP 5</span></h2>
                    <pre class="fragment"><code class="php" data-trim>
array(2) {
    ["b"]=>
    &int(1)
    ["a"]=>
    &int(1)
}
                    </code></pre>
                </section>
                <section>
                    <h2>O mesmo código no</h2>
                    <h2><span class="zf-color">PHP 7</span></h2>
                    <pre class="fragment"><code class="php" data-trim>
array(2) {
    ["a"]=>
    &int(1)
    ["b"]=>
    &int(1)
}
                    </code></pre>
                </section>

                <section id="variavel-global">
                    <h2><span class="php-color">global</span> aceita apenas variáveis <span class="zf-color">simples</span></h2>
                    <p class="fragment"><a href="http://php.net/manual/pt_BR/language.variables.variable.php" target="_blank">Variáveis variáveis</a> não podem ser usadas com a palavra-chave <strong>global</strong></p>
                    <pre class="fragment"><code class="php" data-trim>
function f() {
    // Valid in PHP 5 only.
    global $$foo->bar;

    // Valid in PHP 5 and 7.
    global ${$foo->bar};
}
                    </code></pre>
                    <p class="fragment">Procure não usar uma variável <a href="http://php.net/manual/pt_BR/language.variables.scope.php#language.variables.scope.global" target="_blank">global</a> "do nada"</p>
                </section>

                <section>
                    <h3>O uso de <span class="doctrine-color">parênteses</span> nos <span class="zf-color">parâmetros</span> de funções não tem mais efeito</h3>
                </section>

                <section>
                    <p>No PHP 5, o uso de <strong>parênteses no parâmetro da função</strong> quando o parêmetro é uma outra função, não exibia <span class="doctrine-color">warning</span></p>
                    <pre class="fragment"><code class="php" data-trim>function getArray() {
    return [1, 2, 3];
}
function squareArray(array &$a) {
    foreach ($a as &$v) {
        $v **= 2;
    }
}
// Generates a warning in PHP 7.
squareArray((getArray()));</code></pre>
                    <p class="fragment"><strong>Notice</strong>: Only variables should be passed by reference in /tmp/test.php on line 13</p>
                </section>

                <section id="mudancas-no-foreach">
                    <h2>Mudanças no <span class="php-color">foreach</span></h2>
                </section>

                <section>
                    <h3><a href="http://php.net/manual/pt_BR/control-structures.foreach.php" target="_blank">foreach</a> por valor opera numa <span class="zf-color">cópia do array</span></h3>
                    <p class="fragment">Isso significa que as <strong>mudanças feitas no array</strong> durante a iteração, <strong>não</strong> irão afetar os valores iterados</p>
                </section>

                <section>
                    <h3><span class="zf-color">Melhora</span> no comportamento da iteração no <span class="php-color">foreach</span> "por referência"</h3>
                </section>

                <section>
                    <p>Quando você iterar sobre um array "por referência", o <span class="zf-color">PHP 7</span> irá manter a iteração atualizada sobre mudanças no array</p>
                    <pre class="fragment"><code class="php" data-trim>
$array = [0];
foreach ($array as &$val) {
    var_dump($val);
    $array[1] = 1;
}
                    </code></pre>
                    <p class="fragment">No <span class="zf-color">PHP 7</span> você irá incrementar o array que está sendo iterado</p>
                </section>

                <section>
                    <h3>O código abaixo no <span class="doctrine-color">PHP 5</span></h3>
                    <pre><code class="php" data-trim>
$array = [0];
foreach ($array as &$val) {
    var_dump($val);
    $array[1] = 1;
}
                    </code></pre>
                    <p class="fragment">Irá imprimir:</p>
                    <pre class="fragment"><code class="php" data-trim>
int(0)
                    </code></pre>
                </section>

                <section>
                    <h3>O código abaixo no <span class="zf-color">PHP 7</span></h3>
                    <pre><code class="php" data-trim>
$array = [0];
foreach ($array as &$val) {
    var_dump($val);
    $array[1] = 1;
}
                    </code></pre>
                    <p class="fragment">Irá imprimir:</p>
                    <pre class="fragment"><code class="php" data-trim>
int(0)
int(1)
                    </code></pre>
                </section>

                <section>
                    <h3><span class="zf-color">Nomes inválidos</span> para Classes, Interfaces e Traits</h3>
                    <pre class="fragment"><code class="php" data-trim>
bool
int
float
string
NULL
TRUE
FALSE
                    </code></pre>
                </section>

                <section>
                    <h3><span class="doctrine-color">Reservados</span> para o futuro</h3>
                    <p class="fragment">Nomes que <strong>não irão causar erro</strong> mas estão reservados para o futuro e devem ser considerados deprecated</p>
                    <pre class="fragment"><code class="php" data-trim>
resource
object
mixed
numeric
                    </code></pre>
                </section>

                <section>
                    <h3>Tags <span class="doctrine-color">ASP</span> e <span class="zf-color">script PHP</span> foram <strong>removidas</strong></h3>
                        <table class="reveal">
                            <tr class="fragment">
                                <td>Tag de abertura</td>
                                <td>Tag de fechamento</td>
                            </tr>
                            <tr class="fragment">
                                <td><%</td>
                                <td>%></td>
                            </tr>
                            <tr class="fragment">
                                <td><%=</td>
                                <td>%></td>
                            </tr>
                        </table>
                    <pre class="fragment"><code class="php" data-trim>
<script language="php"></script>
                    </code></pre>
                </section>

                <section>
                    <h3><span class="zf-color">Comentários</span> em arquivos <strong>INI</strong> com <span class="php-color"><strong>#</strong></span> foram removidos</h3>
                    <p class="fragment">O suporte a comentários com # foi removido e agora deve ser utilizado o <strong>; (ponto e vírgula)</strong></p>
                    <p class="fragment">As mudanças se aplicam tanto ao arquivo <span class="php-color">php.ini</span> quanto aos manipulados por <a href="http://php.net/manual/pt_BR/function.parse-ini-file.php" target="_blank">parse_ini_file()</a> e <a href="http://php.net/manual/pt_BR/function.parse-ini-string.php" target="_blank">parse_ini_string()</a></p>
                </section>

				<section>
                    <h2><span class="zf-color"><strong>Novos</strong></span> recursos</h2>
                    <!--
                    <ul class="fragment">
                        <li><code>Declaração de tipo escalar</code></li>
                        <li><code>Declaração de tipo de retorno</code></li>
                        <li><code>Operador coalesce para NULL <strong>??</strong></code></li>
                        <li><code>Operador space ship <strong><=></strong></code></li>
                        <li><code>Arrays de constantes usando <strong>define</strong></code></li>
                        <li><code>Classes anônimas</code></li>
                        <li><code>Sintaxe de escape para Unicode</code></li>
                    </ul>
                    -->
                </section>

                <section id="declaracao-de-tipo">
                    <h3><span class="zf-color">Declaração</span> de tipo escalar</h3>
                    <p class="fragment">A declaração de tipos agora vai além de nomes de <strong>classes</strong>, <strong>interfaces</strong> e <strong>arrays</strong></p>
                </section>

                <section>
                    <h3>A <span class="doctrine-color">declaração de tipos</span> no <span class="zf-color">PHP 7</span> agora inclui:</h3>
                    <p class="fragment">Strings <strong>(string)</strong></p>
                    <p class="fragment">Integers <strong>(int)</strong></p>
                    <p class="fragment">Floating-point numbers <strong>(float)</strong></p>
                    <p class="fragment">Booleans <strong>(bool)</strong></p>
                    <p class="fragment">Ver <a href="http://php.net/manual/pt_BR/functions.arguments.php#functions.arguments.type-declaration" target="_blank">documentação</a></p>
                </section>

                <section>
                    <h3>Exemplo de <span class="zf-color">declaração de tipo</span></h3>
                    <pre class="fragment"><code class="php" data-trim>
// Coercive mode
function sumOfInts(int ...$ints)
{
    return array_sum($ints);
}

var_dump(sumOfInts(2, '3', 4.1));
                    </code></pre>
                    <p class="fragment">O exemplo acima imprime:</p>
                    <pre class="fragment"><code class="php" data-trim>
int(9)
                    </code></pre>
                </section>

                <section id="declaracao-de-tipo-de-retorno">
                    <h3>Declaração de <span class="zf-color">tipo de retorno</span></h3>
                    <p class="fragment">O <span class="php-color">PHP 7</span> adicionou o suporte a declaração de tipo de retorno</p>
                    <p class="fragment">Similar à declaração de tipo de argumento, especifica o <strong>tipo de retorno que uma função irá retornar</strong></strong></p>
                </section>

                <section>
                    <h3>Exemplo de declaração de <span class="zf-color">tipo de retorno</span></h3>
                    <pre class="fragment"><code class="php" data-trim>
function arraysSum(array ...$arrays): array
{
    return array_map(function(array $array): int {
        return array_sum($array);
    }, $arrays);
}

print_r(arraysSum([1,2,3], [4,5,6], [7,8,9]));
                    </code></pre>
                </section>

                <section id="operador-coalesce-para-null">
                    <h2>Operador <span class="zf-color">coalesce</span> para <strong>NULL</strong></h2>
                    <p class="fragment">O operador coalesce para NULL (<strong>??</strong>) foi adicionado como um incremento sintático para as situações onde se usa o ternário junto ao isset()</p>
                </section>

                <section>
                    <h3>Exemplo de uso do <span class="zf-color">operador</span> coalesce <strong>??</strong>:</h3>
                    <pre class="fragment"><code class="php" data-trim>
// Fetches the value of $_GET['user'] and returns 'nobody'
// if it does not exist.
$username = $_GET['user'] ?? 'nobody';
// This is equivalent to:
$username = isset($_GET['user']) ? $_GET['user'] : 'nobody';

// Coalesces can be chained: this will return the first
// defined value out of $_GET['user'], $_POST['user'], and
// 'nobody'.
$username = $_GET['user'] ?? $_POST['user'] ?? 'nobody';
                    </code></pre>
                </section>

                <section id="operador-spaceship">
                    <h2>Operador <span class="zf-color">spaceship</span></h2>
                    <p class="fragment">O operador spaceship (isso mesmo, operador "nave espacial"), é usado para comparar dois valores</p>
                    <p class="fragment">Ele irá <strong>retorna -1, 0 ou 1</strong> quando o valor $a for respectivamente menor que, igual a ou maior que $b</p>
                    <p class="fragment">As comparações são realizadas seguindo a mesma <a href="http://php.net/manual/pt_BR/types.comparisons.php" target="_blank">regra de comparação de tipos</a> já existente</p>
                </section>

                <section>
                    <h3>Exemplo de uso do <span class="zf-color">operador spaceship</span> <strong><=></strong></h3>
                    <pre class="fragment"><code class="php" data-trim>
// Integers
echo 1 <=> 1; // 0
echo 1 <=> 2; // -1
echo 2 <=> 1; // 1

// Floats
echo 1.5 <=> 1.5; // 0
echo 1.5 <=> 2.5; // -1
echo 2.5 <=> 1.5; // 1

// Strings
echo "a" <=> "a"; // 0
echo "a" <=> "b"; // -1
echo "b" <=> "a"; // 1
                    </code></pre>
                </section>

                <section id="constantes-de-array">
                    <h2><span class="zf-color">Constantes</span> de array usando <span class="php-color">define()</span></h2>
                    <p class="fragment">Constantes de Array agora podem ser definidas com o <a href="http://php.net/manual/pt_BR/function.define.php" target="_blank">define()</a>. No PHP 5.6 só podiam com o <a href="http://php.net/manual/pt_BR/language.constants.syntax.php" target="_blank">const</a> (fora da definição de uma classe)</p>
                </section>

                <section>
                    <h3>Exemplo de definição de <span class="doctrine-color">constantes de Array</span></h3>
                    <pre class="fragment"><code class="php" data-trim>
define('ANIMALS', [
    'dog',
    'cat',
    'bird'
]);

echo ANIMALS[1]; // outputs "cat"
                    </code></pre>
                </section>

                <section id="classes-anonimas">
                    <h2>Classes <span class="doctrine-color">anônimas</span></h2>
                    <p class="fragment">Suporte a classes anônimas foi adicionado através do <strong>new class</strong></p>
                </section>

                <section>
                    <p>Exemplo de definição de <span class="doctrine-color">classe anônima</span></p>
                    <pre class="fragment"><code class="php" data-trim>
// Leve em consideração que já foram criadas
// a interface Logger e a classe Application...

$app = new Application;
$app->setLogger(new class implements Logger {
    public function log(string $msg) {
        echo $msg;
    }
});

var_dump($app->getLogger());
                    </code></pre>
                    <p class="fragment">O exemplo acima irá imprimir:</p>
                    <pre class="fragment"><code class="php" data-trim>
object(class@anonymous)#2 (0) {
}
                    </code></pre>
                    <p class="fragment">Documentação de <a href="http://php.net/manual/pt_BR/language.oop5.anonymous.php" target="_blank">classes anônimas</a></p>
                </section>

                <section id="declaracao-agrupado-do-use">
                    <h2>Declaração agrupada do <span class="php-color">use</span></h2>
                    <p class="fragment">Classes, funções e constantes <span class="doctrine-color">importadas do mesmo namespace</span> agora podem ser <span class="zf-color">agrupadas</span> no mesmo statement <strong>use</strong></p>
                </section>

                <section>
                    <h3>Exemplo de uso agrupado do <span class="php-color">use</span></h3>
                    <pre class="fragment"><code class="php" data-trim>
// Pre PHP 7 code
use some\namespace\ClassA;
use some\namespace\ClassB;
use some\namespace\ClassC as C;

use function some\namespace\fn_a;
use function some\namespace\fn_b;
use function some\namespace\fn_c;

use const some\namespace\ConstA;
use const some\namespace\ConstB;
use const some\namespace\ConstC;

// PHP 7+ code
use some\namespace\{ClassA, ClassB, ClassC as C};
use function some\namespace\{fn_a, fn_b, fn_c};
use const some\namespace\{ConstA, ConstB, ConstC};
                    </code></pre>
                </section>

                <section id="nova-funcao-intdiv">
                    <h3>Nova função <span class="php-color">intdiv()</span> para divisão de inteiros</h3>
                    <p class="fragment">Executa uma <span class="zf-color">divisão de inteiros</span> e retorna um inteiro</p>
                </section>

                <section>
                    <p>Exemplos de uso do <span class="php-color"><a href="http://php.net/manual/pt_BR/function.intdiv.php" target="_blank">intdiv()</a></span></p>
                    <pre class="fragment"><code class="php" data-trim>
var_dump(intdiv(3, 2));
var_dump(intdiv(-3, 2));
var_dump(intdiv(3, -2));
var_dump(intdiv(-3, -2));
var_dump(intdiv(PHP_INT_MAX, PHP_INT_MAX));
var_dump(intdiv(PHP_INT_MIN, PHP_INT_MIN));
var_dump(intdiv(PHP_INT_MIN, -1));
var_dump(intdiv(1, 0));
                    </code></pre>
                    <p class="fragment">Retorna:</p>
                    <pre class="fragment"><code class="php" data-trim>
int(1)
int(-1)
int(-1)
int(1)
int(1)
int(1)

Fatal error: Uncaught ArithmeticError: Division of PHP_INT_MIN by -1 is not an integer in %s on line 8
Fatal error: Uncaught DivisionByZeroError: Division by zero in %s on line 9
                    </code></pre>
                </section>

                <section>
                    <h2>Opções para o <span class="php-color">session</span></h2>
                    <p class="fragment"><a href="http://php.net/manual/pt_BR/function.session-start.php" target="_blank">session_start()</a> agora aceita um array de opções que sobrescreve o que estiver definido no php.ini</p>
                </section>

                <section>
                    <h3>Exemplo de uso do <span class="php-color">session_start()</span></h3>
                    <p class="fragment">Se você quiser por exemplo alterar o parâmetro <span class="doctrine-color">session.cache_limiter</span> para private e fechar a sessão imediatamente após a leitura pode usar:</p>
                    <pre class="fragment"><code class="php" data-trim>
session_start([
    'cache_limiter' => 'private',
    'read_and_close' => true,
]);
                    </code></pre>
                </section>

                <section id="duas-novas-funcoes-para-inteiros-e-strings">
                    <h3>Duas <span class="zf-color">novas funções</span> foram criadas para retornar inteiros e strings <span class="doctrine-color">criptograficamente</span> seguros</h3>
                    <p class="fragment"><a href="http://php.net/manual/pt_BR/function.random-bytes.php" target="_blank">random_bytes()</a></p>
                    <p class="fragment"><a href="http://php.net/manual/pt_BR/function.random-int.php" target="_blank">random_int()</a></p>
                </section>

                <section id="random_bytes">
                    <h3>Exemplo de uso do <span class="php-color">ramdon_bytes()</span></h3>
                    <pre class="fragment"><code class="php" data-trim>
$bytes = random_bytes(5);
var_dump(bin2hex($bytes));
                    </code></pre>
                    <p class="fragment">Retorna algo similar a:</p>
                    <pre class="fragment"><code class="php" data-trim>
string(10) "385e33f741"
                    </code></pre>
                </section>

                <section id="random_int">
                    <h3>Exemplo de uso do <span class="php-color">ramdon_int()</span></h3>
                    <pre class="fragment"><code class="php" data-trim>
var_dump(random_int(100, 999));
var_dump(random_int(-1000, 0));
                    </code></pre>
                    <p class="fragment">Retorna algo similar a:</p>
                    <pre class="fragment"><code class="php" data-trim>
int(248)
int(-898)
                    </code></pre>
                </section>

                <section>
                    <h2>Recursos <span class="doctrine-color">deprecated</span> no <span class="zf-color">PHP 7.0.x</span></h2>
                </section>

                <section id="construtores">
                    <h3><span class="zf-color">Construtores</span> no estilo <span class="doctrine-color">PHP 4</span></h3>
                    <p class="fragment">Construtores no estilo do PHP 4 (onde o construtor tem o mesmo nome da função) agora são <span class="doctrine-color">deprecated </span> e serão removidos no futuro</p>
                    <p class="fragment">O <span class="zf-color">PHP 7</span> irá emitir um <strong>E_DEPRECATED</strong> se o um construtor PHP 4 for o único construtor da classe</p>
                    <p class="fragment">Classes que implementam <strong>__construct()</strong> não serão afetadas</p>
                </section>

                <section>
                    <p>Exemplo de uso de construtor PHP 4 <span class="doctrine-color">(deprecated)</span></p>
                    <pre class="fragment"><code class="php" data-trim>
class foo {
    function foo() {
        echo 'I am the constructor';
    }
}
                    </code></pre>
                    <p class="fragment">O exemplo acima irá imprimir:</p>
                    <pre class="fragment"><code class="php" data-trim>
Deprecated: Methods with the same name as their class
will not be constructors in a future version of PHP;
foo has a deprecated constructor in example.php on line 3
                    </code></pre>
                </section>

                <section>
                    <h3><span class="zf-color">Chamadas</span> estáticas a <span class="doctrine-color">métodos</span> não estáticos</h3>
                    <pre class="fragment"><code class="php" data-trim>
class foo {
    function bar() {
        echo 'I am not static!';
    }
}

foo::bar();
                    </code></pre>
                    <p class="fragment">O exemplo acima irá imprimir:</p>
                    <pre class="fragment"><code class="php" data-trim>
Deprecated: Non-static method foo::bar()
should not be called statically in - on line 8
I am not static!
                    </code></pre>
                </section>

                <!-- CONTRIBUINDO -->
                <section id="montando-ambiente-de-testes">
                    <h2>Que tal montar seu <span class="doctrine-color">próprio ambiente</span> de testes no <span class="zf-color"><strong>PHP 7</strong></span>?</h2>
                </section>
                <section id="intalando-vagrant">
                    <h3>Instale o <span class="zf-color">Vagrant</span> e <span class="php-color">Virtualbox</span></h3>
                    <p class="fragment">Em seguida:</p>
                    <pre class="fragment"><code class="php" data-trim>
$ git clone https://github.com/rlerdorf/php7dev.git

$ cd php7dev

$ vagrant up
... (takes a bit - it is downloading 1.5G)

$ vagrant ssh
                    </code></pre>
                    <p class="fragment">Sua máquina estará disponível no IP fixo <span class="php-color">192.168.7.7</span></p>
                </section>

                <section id="acessando-servidor-teste">
                    <h2>Ao acessar <strong>http://192.168.7.7</strong></h2>
                    <h2 class="fragment">Será exibida a página <span class="php-color">phpinfo()</span> do <span class="zf-color">PHP 7</span></h2>
                </section>
                <section id="mudando-entre-versoes-rapidamente">
                    <h2><span class="zf-color">Mudar</span> entre as versões é muito fácil</h2>
                    <pre class="fragment"><code class="shell" data-trim>
vagrant@php7dev:~$ sudo newphp 56
Activating PHP 5.6.6-dev and restarting php-fpm

vagrant@php7dev:~$ sudo newphp 7 debug
Activating PHP 7.0.0-dev and restarting php-fpm
                    </code></pre>
                    <p class="fragment">Estão disponíveis <strong>20 versões pre-compiladas</strong> começando na 5.3</p>
                </section>
				
				<!-- FIM -->
                <section>
                    <h2>Referências</h2>
                    <p><a href="https://github.com/tpunt/PHP7-Reference" target="_blank">github.com/tpunt/PHP7-Reference</a></p>
                    <p><a href="https://github.com/rlerdorf/php7dev" target="_blank">github.com/rlerdorf/php7dev</a></p>
                    <p><a href="http://talks.php.net/oz15#/" target="_blank">talks.php.net/oz15#/</a></p>
                </section>

                <section>
                    <h2><strong>Muito obrigado!</strong></h2>
                    <p>Fique à vontade para me seguir no <span class="zf-color">GitHub</span></p>
                    <p><a href="https://github.com/diegonobre">github.com/diegonobre</a></p>
                </section>
            </div>
        </div>
        <script src="bower_components/reveal.js/lib/js/head.min.js"></script>
        <script src="bower_components/reveal.js/js/reveal.js"></script>
        <script>
            Reveal.initialize({
                controls:     true,
                progress:     true,
                history:      true,
                center:       true,
                transition:   'none',
                // Optional reveal.js plugins
                dependencies: [
                    {
                        src: 'bower_components/reveal.js/lib/js/classList.js',
                        condition: function() { return !document.body.classList; }
                    },
                    {
                        src: 'bower_components/reveal.js/plugin/markdown/marked.js',
                        condition: function() { return !!document.querySelector( '[data-markdown]' ); }
                    },
                    {
                        src: 'bower_components/reveal.js/plugin/markdown/markdown.js',
                        condition: function() { return !!document.querySelector( '[data-markdown]' ); }
                    },
                    {
                        src: 'bower_components/reveal.js/plugin/highlight/highlight.js',
                        async: true,
                        condition: function() { return !!document.querySelector( 'pre code' ); },
                        callback: function() { hljs.initHighlightingOnLoad(); }
                    },
                    {
                        src: 'bower_components/reveal.js/plugin/zoom-js/zoom.js',
                        async: true
                    },
                    {
                        src: 'bower_components/reveal.js/plugin/notes/notes.js',
                        async: true
                    }
                ]
            });

            /* This draws the graph on the slide on a slidechanged event */
            Reveal.addEventListener('slidechanged', function(event) {
                var callback = "render_"+event.currentSlide.id;
                if(typeof(window[callback])=="function") {
                    window[callback]();
                }
            } );
            /* This draws the graph if we got here directly without coming from another slide */
            Reveal.addEventListener('ready', function(event) {
                var callback = "render_"+event.currentSlide.id;
                if(typeof(window[callback])=="function") {
                    window[callback]();
                }
            } );
        </script>
    </body>
</html>